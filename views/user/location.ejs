<% layout('../layout/boilerplateLocation') -%>
<script>
    const mapToken = "<%=process.env.MAP_TOKEN%>";
</script>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.16.0/mapbox-gl.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.16.0/mapbox-gl.css" rel="stylesheet" />
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" rel="stylesheet" />

<div id="loading-spinner" style="display: none;">
    <div class="loader"></div>
    <p class="spinner-text">Loading, please wait...</p>
</div>
<div id="geocoder"></div>
<div id="map" style="height: 80vh;"></div>
<div class="continue justify-content-center align-items-center">
    <button class="btn btn-success add-btn" id="detect-location">Use Current Location</button>
    <form id="address-form" method="POST" action="/order/<%= currUser._id %>/update-address">
        <input type="hidden" name="coordinates" id="center-coordinates">
        <button type="submit" class="btn btn-success">Continue</button>
    </form>   
    
    <div class="toggle">
    </div>
</div>
<script src="/js/map.js"></script>
  

<style>
    /* Ensure map has proper height */
#map {
    width: 100%;
    height: 400px;
    border: 1px solid #ddd;
    margin-bottom: 20px;
}

/* Style the geocoder */
#geocoder {
    margin-bottom: 10px;
}

/* Adjust layout spacing */
h2 {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.continue {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
}

button {
    margin-right: 10px;
}

/* Loading Spinner */
.spinner-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1050;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s, visibility 0.3s;
}

.spinner-overlay.active {
    visibility: visible;
    opacity: 1;
}

.spinner-text {
    margin-top: 20px;
    font-size: 1.2rem;
    font-weight: 500;
    color: #fc060a;
}

.loader {
    position: relative;
    transform: rotateZ(45deg);
    perspective: 1000px;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    color: #fff;
}

.loader:before,
.loader:after {
    content: '';
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: inherit;
    height: inherit;
    border-radius: 50%;
    transform: rotateX(70deg);
    animation: 1s spin linear infinite;
}

.loader:after {
    color: #FF3D00;
    transform: rotateY(70deg);
    animation-delay: 0.4s;
}

@keyframes spin {
    0%,
    100% {
        box-shadow: 0.2em 0px 0 0px currentcolor;
    }
    12% {
        box-shadow: 0.2em 0.2em 0 0 currentcolor;
    }
    25% {
        box-shadow: 0 0.2em 0 0 currentcolor;
    }
    37% {
        box-shadow: -0.2em 0.2em 0 0 currentcolor;
    }
    50% {
        box-shadow: -0.2em 0 0 0 currentcolor;
    }
    62% {
        box-shadow: -0.2em -0.2em 0 0 currentcolor;
    }
    75% {
        box-shadow: 0px -0.2em 0 0 currentcolor;
    }
    87% {
        box-shadow: 0.2em -0.2em 0 0 currentcolor;
    }
}
</style>
<script>
    window.addEventListener('load', () => {
      window.scrollTo(0, 50);
    });
</script>
